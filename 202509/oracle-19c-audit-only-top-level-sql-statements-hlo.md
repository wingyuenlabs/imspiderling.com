---
Title: Oracle 19c — Audit Only Top-Level SQL Statements
Description: 
Author: Vahid Yousefzadeh
Date: 2025-09-06T21:05:14.000Z
Robots: noindex,nofollow
Template: index
---
<p>If the volume of logs generated by the unified auditing feature is relatively high, referring to and maintaining the audit trail may lead to performance issues and storage shortages. Therefore, auditing should be configured in a way that avoids storing unnecessary information in the related table.</p>

<p>The new Oracle 19c feature called Auditing Only Top-Level SQL Statements can be effective in this regard.</p>

<p>With this feature, you can enable auditing only for statements that are executed directly by the user (so-called Top-Level statements) and ignore auditing statements that are executed as part of a procedure call.</p>

<p>To use this feature, you simply need to add the clause ONLY TOPLEVEL to the CREATE AUDIT POLICY statement. Additionally, by checking the column AUDIT_ONLY_TOPLEVEL in the view AUDIT_UNIFIED_POLICIES, you can see which audit policies are using this feature. See the example below:</p>

<p>Example: Consider the following procedure:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>create or replace procedure myproc1  as

begin

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

insert into  mytbl select * from v$datafile;

commit;

end;
</code></pre>

</div>



<p>Suppose we want to audit some of the actions performed by user usef. For this purpose, we create an audit policy with the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; create audit policy actions_all_pol actions all;
Audit policy created.
</code></pre>

</div>



<p>Then we enable the created audit policy for user usef:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; audit policy actions_all_pol by usef;
Audit succeeded.
</code></pre>

</div>



<p>User usef executes the procedure myproc1:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; exec myproc1;
PL/SQL procedure successfully completed
</code></pre>

</div>



<p>By checking the unified_audit_trail view, we will see that 11 records were added to the audit trail for this procedure execution:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt;select count(*) from unified_audit_trail f where f.unified_audit_policies=’ACTIONS_ALL_POL’;

11
</code></pre>

</div>



<p>We can display the recorded information with the following command:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; select f.sessionid,f.action_name,f.object_schema,f.object_name from unified_audit_trail f where f.unified_audit_policies=’ACTIONS_ALL_POL’;
</code></pre>

</div>



<p><a href="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Faucle60dcrmpffmrjsqd.png" class="article-body-image-wrapper"><img src="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Faucle60dcrmpffmrjsqd.png" alt=" " width="634" height="349"></a><br>
As shown, the text of the INSERT statements inside the myproc1 procedure were recorded in the audit trail.</p>

<p>Now, we want to use the Auditing Only Top-Level SQL Statements feature to prevent logging extra information. So, we repeat the process again:</p>

<p>— Delete existing records from the aud$unified table and disable the created audit policy:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; begin
       dbms_audit_mgmt.clean_audit_trail(
         audit_trail_type =&gt; dbms_audit_mgmt.audit_trail_unified,
         use_last_arch_timestamp =&gt; false
       );
     end;
/

SQL&gt; noaudit policy actions_all_pol by usef;
Noaudit succeeded.
</code></pre>

</div>



<p>— Create a new audit policy with the ONLY TOPLEVEL clause:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; create audit policy TOPLEVEL_on actions all ONLY TOPLEVEL;
Audit policy created.
</code></pre>

</div>



<p>— Enable the created audit policy for user usef:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; audit policy TOPLEVEL_on by usef;
Audit succeeded.
</code></pre>

</div>



<p>— Execute the procedure by user usef:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; exec myproc1;
PL/SQL procedure successfully completed
</code></pre>

</div>



<p>— With this procedure execution, only 1 record will be added to the audit trail:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>SQL&gt; select f.sessionid, f.action_name, f.sql_text 
     from unified_audit_trail f 
     where f.unified_audit_policies = 'TOPLEVEL_ON';
</code></pre>

</div>



<p><a href="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F3txf5qr8r8y5prd2yp48.png" class="article-body-image-wrapper"><img src="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F3txf5qr8r8y5prd2yp48.png" alt=" " width="439" height="78"></a><br>
As you can see, with the help of the Auditing Only Top-Level SQL Statements feature, only the statement that was executed directly by the user is recorded in the audit trail.</p>

