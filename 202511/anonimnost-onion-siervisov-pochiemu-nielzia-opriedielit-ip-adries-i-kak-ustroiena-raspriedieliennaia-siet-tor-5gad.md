---
Title: Анонимность onion-сервисов: почему нельзя определить IP-адрес и как устроена распределенная сеть Tor
Description: 
Author: defX
Date: 2025-11-11T21:39:38.000Z
Robots: noindex,nofollow
Template: index
---
<p>Когда речь заходит об анонимности в интернете, первое, что приходит на ум — сеть Tor и её загадочные .onion-сайты. Многие уверены, что за каждым таким сайтом стоит сервер, IP-адрес которого можно каким-то образом вычислить. В этой статье мы развеем этот миф и глубоко погрузимся в архитектуру Tor, чтобы понять, почему определение IP-адреса onion-сервиса технически невозможно.</p>

<ol>
<li>Базовые принципы: чем Tor отличается от обычного интернета</li>
</ol>

<p>Обычный интернет:</p>

<p>Пользователь → DNS-запрос → IP-адрес → Подключение к серверу<br>
Tor Network:</p>

<p>Пользователь → Цепочка узлов → Onion-адрес → Скрытый сервис<br>
Ключевое отличие: В Tor не используется DNS и нет преобразования доменных имен в IP-адреса.</p>

<ol>
<li>Архитектура скрытых сервисов: тройная защита</li>
</ol>

<p>Onion-сервисы используют многоуровневую систему безопасности:</p>

<p>Компоненты подключения:</p>

<p>Introduction Points (Входные точки) - 3 случайных узла, знающие как связаться с сервисом<br>
Rendezvous Points (Точки встречи) - промежуточные узлы для установки соединения<br>
Сервис - собственно onion-сайт</p>

<p>Клиент → Цепочка Tor → RP ↔ Introduction Points ↔ Onion-сервис<br>
Криптографическая защита:</p>

<p>Многослойное шифрование (принцип "луковицы")<br>
Каждый узел знает только предыдущий и следующий<br>
Ни один узел не знает полного пути</p>

<ol>
<li>DHT Tor: распределенная база данных вместо DNS</li>
</ol>

<p>Что такое DHT (Distributed Hash Table)?</p>

<p>Tor использует полностью децентрализованную систему для хранения информации о сервисах:</p>

<h1>
  
  
  Псевдокод работы DHT
</h1>

<p>class TorDHT:<br>
    def store_descriptor(self, onion_address, descriptor):<br>
        # Дескриптор хранится на нескольких HSDir узлах<br>
        positions = self.calculate_positions(onion_address)<br>
        for position in positions:<br>
            hsdir = self.find_responsible_node(position)<br>
            hsdir.store(descriptor)</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>def find_descriptor(self, onion_address):
    positions = self.calculate_positions(onion_address)
    for position in positions:
        hsdir = self.find_responsible_node(position)
        descriptor = hsdir.retrieve(onion_address)
        if descriptor:
            return descriptor
    return None
</code></pre>

</div>

<p>Onion-адрес — это публичный ключ</p>

<p>Формат v3 onion-адреса: 56-символов.onion</p>

<p>Это не случайный набор символов, а хеш от:</p>

<p>Публичного ключа сервиса<br>
Версии протокола<br>
Дополнительных параметров</p>

<ol>
<li>HSDir узлы: хранители тайн сети</li>
</ol>

<p>Кто может быть HSDir?</p>

<p>Не каждый узел Tor может стать HSDir. Требуются строгие критерии:</p>

<p>def can_be_hsdir(router):<br>
    return (router.uptime &gt; 96 * 3600 and      # 4+ дней стабильной работы<br>
            router.bandwidth &gt; MIN_BANDWIDTH and # Достаточная скорость<br>
            router.version &gt;= SUPPORTED_VERSION and # Актуальная версия<br>
            'Stable' in router.flags and       # Стабильное соединение<br>
            'Fast' in router.flags)            # Высокая скорость<br>
Статистика сети:</p>

<p>Всего узлов Tor: ~6,000-8,000<br>
HSDir узлов: ~2,000-3,000 (30-40%)<br>
Только лучшие узлы получают эту привилегию<br>
Что хранят HSDir узлы:</p>

<p>HSDir_Storage = {<br>
    'descriptors': [<br>
        {<br>
            'service_id': 'abc123...onion',<br>
            'intro_points': ['ip1:port1', 'ip2:port2'],  # Через Tor!<br>
            'timestamp': '2024-01-15 10:30:00',<br>
            'expires': '2024-01-16 10:30:00'<br>
        }<br>
    ],<br>
    'no_content': True,     # НЕ хранит контент сайтов<br>
    'no_user_data': True,   # НЕ хранит данные пользователей<br>
}</p>

<ol>
<li>Почему определение IP технически невозможно</li>
</ol>

<p>Архитектурные причины:</p>

<p>Нет прямого соединения между клиентом и сервером<br>
Introduction Points знают только как связаться с сервисом, но не его IP<br>
Шифрование на каждом этапе<br>
Распределенность информации<br>
Что видят участники сети:</p>

<p>Клиент: знает только onion-адрес и точки встречи<br>
RP-узлы: знают только клиента и introduction points<br>
Introduction Points: знают только сервис и RP<br>
HSDir узлы: знают только дескрипторы, но не могут подключиться к сервису<br>
Сервис: не знает IP клиента<br>
Даже при компрометации нескольких узлов:</p>

<h1>
  
  
  Максимум что можно узнать при контроле 1-2 узлов
</h1>

<p>compromised_knowledge = {<br>
    'rp_node': ['client_ip', 'intro_points_ip'],<br>
    'intro_point': ['service_ip', 'rp_node_ip'], <br>
    'hsdir_node': ['descriptor_data']<br>
}</p>

<h1>
  
  
  Но никогда не будет полной картины:
</h1>

<p>full_picture = {<br>
    'client_ip': '...',<br>
    'service_ip': '...', <br>
    'full_communication': '...'<br>
}</p>

<ol>
<li>Распространенные заблуждения</li>
</ol>

<p>"WebRTC может раскрыть IP сервиса"</p>

<p>НЕТ: WebRTC работает на клиентской стороне<br>
Onion-сервис не может инициировать WebRTC соединение<br>
В Tor Browser WebRTC полностью отключен<br>
"Можно отследить трафик до сервера"</p>

<p>НЕТ: Трафик проходит через минимум 6 узлов (3 от клиента, 3 к сервису)<br>
Каждый узел знает только соседей<br>
Шифрование перестраивается на каждом узле<br>
"HSDir узлы знают IP сервисов"</p>

<p>НЕТ: Они хранят только дескрипторы с информацией об introduction points<br>
Introduction Points сами являются Tor-узлами, а не конечным сервисом</p>

<ol>
<li>Реальные случаи провалов анонимности</li>
</ol>

<p>Исторически большинство раскрытий onion-сервисов происходили из-за:</p>

<p>Ошибок конфигурации (80% случаев)<br>
Человеческого фактора<br>
Эксплойтов нулевого дня (крайне редко)</p>

<ol>
<li>Как обеспечивается отказоустойчивость</li>
</ol>

<p>Репликация дескрипторов:</p>

<h1>
  
  
  Каждый дескриптор хранится на 3+ HSDir узлах
</h1>

<p>replica_positions = [<br>
    H(descriptor_id | period | 0),<br>
    H(descriptor_id | period | 1), <br>
    H(descriptor_id | period | 2)<br>
]<br>
Ротация узлов:</p>

<p>HSDir узлы меняются каждые 24 часа<br>
Introduction Points ротируются регулярно<br>
Автоматическое восстановление при сбоях</p>

<ol>
<li>Практические выводы</li>
</ol>

<p>Для пользователей:</p>

<p>Onion-сервисы анонимны по дизайну<br>
Можно безопасно посещать .onion сайты<br>
IP-адрес сервиса невозможно определить<br>
Для исследователей:</p>

<p>Архитектура Tor обеспечивает математическую стойкость<br>
Атаки требуют контроля над значительной частью сети<br>
Существующие методы обнаружения неэффективны против правильно настроенных сервисов<br>
Для администраторов:</p>

<p>Следуйте best practices настройки<br>
Изолируйте сервисы от внешнего мира<br>
Регулярно проводите аудиты безопасности<br>
Заключение</p>

<p>Сеть Tor представляет собой тщательно продуманную систему, где анонимность обеспечивается на архитектурном уровне. Невозможность определения IP-адреса onion-сервиса — это не следствие недостатка инструментов, а фундаментальное свойство системы, основанное на криптографии и распределенных вычислениях.</p>

<p>DHT и HSDir узлы создают устойчивую к цензуре и отказоустойчивую инфраструктуру, где каждый компонент знает ровно столько информации, сколько необходимо для выполнения его функции, но недостаточно для компрометации системы в целом.</p>

<p>Технически при правильной настройке определить IP onion-сервиса невозможно — это особенность архитектуры, а не уязвимость.</p>

<p><a href="https://def-expert.ru/anonimnost-onion-servisov-pochemu-nel-zya-opredelit-ip-adres-i-kak-ustroena-raspredelennaya-set-tor" rel="noopener noreferrer">https://def-expert.ru/anonimnost-onion-servisov-pochemu-nel-zya-opredelit-ip-adres-i-kak-ustroena-raspredelennaya-set-tor</a><br>
Для исследователей:</p>

<p>Архитектура Tor обеспечивает математическую стойкость<br>
Атаки требуют контроля над значительной частью сети<br>
Существующие методы обнаружения неэффективны против правильно настроенных сервисов<br>
Для администраторов:</p>

<p>Следуйте best practices настройки<br>
Изолируйте сервисы от внешнего мира<br>
Регулярно проводите аудиты безопасности<br>
Заключение</p>

<p>Сеть Tor представляет собой тщательно продуманную систему, где анонимность обеспечивается на архитектурном уровне. Невозможность определения IP-адреса onion-сервиса — это не следствие недостатка инструментов, а фундаментальное свойство системы, основанное на криптографии и распределенных вычислениях.</p>

<p>DHT и HSDir узлы создают устойчивую к цензуре и отказоустойчивую инфраструктуру, где каждый компонент знает ровно столько информации, сколько необходимо для выполнения его функции, но недостаточно для компрометации системы в целом.</p>

<p>Технически при правильной настройке определить IP onion-сервиса невозможно — это особенность архитектуры, а не уязвимость.</p>

