---
Title: Top-K queries with MongoDB search indexes (BM25)
Description: 
Author: Franck Pachot
Date: 2026-02-19T22:05:35.000Z
Robots: noindex,nofollow
Template: index
---
<p>A document database is more than a JSON datastore. It must also support efficient storage and advanced search: equality and range predicates, fuzzy text search, ranking, pagination, and limited sorted results (top‑k). BM25 indexes, which combine an inverted index and columnar doc values, are ideal for this, with mature open‑source implementations like Lucene (used by MongoDB) and Tantivy (used by ParadeDB).</p>

<p>ParadeDB brings Tantivy indexing to PostgreSQL via the <code>pg_search</code> extension and recently published an excellent article showing where GIN indexes fall short and how BM25 bridges the gap. Here, I’ll present the MongoDB equivalent using its Lucene‑based search indexes. I suggest reading ParadeDB’s post first, as it clearly explains the problem and the solution:</p>


<div class="crayons-card c-embed text-styles text-styles--secondary">
    <div class="c-embed__content">
        <div class="c-embed__cover">
          <a href="https://www.paradedb.com/blog/optimizing-top-k" class="c-link align-middle" rel="noopener noreferrer">
            <img alt="" src="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fwww.paradedb.com%2Fblog%2Foptimizing-top-k%2Fimages%2Fopengraph-image.png" height="420" class="m-0" width="800">
          </a>
        </div>
      <div class="c-embed__body">
        <h2 class="fs-xl lh-tight">
          <a href="https://www.paradedb.com/blog/optimizing-top-k" rel="noopener noreferrer" class="c-link">
            How We Optimized Top K in Postgres | ParadeDB
          </a>
        </h2>
          <p class="truncate-at-3">
            How ParadeDB uses principles from search engines to optimize Postgres' Top K performance.
          </p>
        <div class="color-secondary fs-s flex items-center">
            <img alt="favicon" class="c-embed__favicon m-0 mr-2 radius-0" src="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fwww.paradedb.com%2Ffavicon.ico%3F57975f116b3c8317" width="256" height="256">
          paradedb.com
        </div>
      </div>
    </div>
</div>


<p>I'll be lazy and use the same dataset, index and query.</p>

<h2>
  
  
  MongoDB with search indexes
</h2>

<p>You can use BM25 indexes on MongoDB in several environments: the cloud-managed service (<a href="https://www.mongodb.com/cloud/atlas/register" rel="noopener noreferrer">MongoDB Atlas</a>), its local deployment (<a href="https://www.mongodb.com/docs/atlas/cli/current/atlas-cli-deploy-local/" rel="noopener noreferrer">Atlas Local</a>), on-premises MongoDB Enterprise Server, and the open-source MongoDB Community edition. The <em>mongot</em> engine that powers MongoDB Search is in <a href="https://www.mongodb.com/company/blog/product-release-announcements/now-source-available-the-engine-powering-mongodb-search" rel="noopener noreferrer">public preview</a>, with its source available at <a href="https://github.com/mongodb/mongot" rel="noopener noreferrer">github.com/mongodb/mongot</a>.</p>

<p>I started a local Atlas deployment on my laptop with <a href="https://www.mongodb.com/docs/atlas/cli/current/install-atlas-cli/" rel="noopener noreferrer">Atlas CLI</a> and connected automatically:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>
atlas deployments setup  mongo <span class="nt">--type</span> <span class="nb">local</span> <span class="nt">--connectWith</span> mongosh <span class="nt">--force</span> 

</code></pre>

</div>



<h2>
  
  
  Dataset generation
</h2>

<p>I generated 100,000,000 documents similar to ParadeDB's <a href="https://github.com/paradedb/paradedb/blob/main/benchmarks/datasets/logs/generate.sql" rel="noopener noreferrer">benchmark</a>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code>
<span class="kd">const</span> <span class="nx">batchSize</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">batches</span>   <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">rows</span>      <span class="o">=</span> <span class="nx">batches</span> <span class="o">*</span> <span class="nx">batchSize</span><span class="p">;</span>
<span class="nf">print</span><span class="p">(</span><span class="s2">`Generating </span><span class="p">${</span><span class="nx">rows</span><span class="p">.</span><span class="nf">toLocaleString</span><span class="p">()}</span><span class="s2"> documents`</span><span class="p">);</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">benchmark_logs</span><span class="p">.</span><span class="nf">drop</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">messages</span> <span class="o">=</span> <span class="p">[</span> <span class="dl">'</span><span class="s1">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research facility analyzed samples from ancient artifacts, revealing breakthrough findings about civilizations lost to the depths of time.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research station monitored weather patterns across mountain peaks, collecting data about atmospheric changes in the remote depths below.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research observatory captured images of stellar phenomena, peering into the cosmic depths to understand the mysteries of distant galaxies.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research laboratory processed vast amounts of genetic data, exploring the molecular depths of DNA to unlock biological secrets.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research center studied rare organisms found in ocean depths, documenting new species thriving in extreme underwater environments.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research institute developed quantum systems to probe subatomic depths, advancing our understanding of fundamental particle physics.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research expedition explored underwater depths near volcanic vents, discovering unique ecosystems adapted to extreme conditions.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research facility conducted experiments in the depths of space, testing how different materials behave in zero gravity environments.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The research team engineered crops that could grow in the depths of drought conditions, helping communities facing climate challenges.</span><span class="dl">'</span> <span class="p">];</span>

<span class="kd">const</span> <span class="nx">countries</span> <span class="o">=</span> <span class="p">[</span> <span class="dl">'</span><span class="s1">United States</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Canada</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">United Kingdom</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">France</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Germany</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Japan</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Australia</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Brazil</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">India</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">China</span><span class="dl">'</span> <span class="p">];</span>

<span class="kd">const</span> <span class="nx">labels</span> <span class="o">=</span> <span class="p">[</span> <span class="dl">'</span><span class="s1">critical system alert</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">routine maintenance</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">security notification</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">performance metric</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">user activity</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">system status</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">network event</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">application log</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">database operation</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">authentication event</span><span class="dl">'</span> <span class="p">];</span>

<span class="kd">let</span> <span class="nx">batch</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">const</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="dl">"</span><span class="s2">2020-01-01T00:00:00Z</span><span class="dl">"</span><span class="p">);</span>
<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rows</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">batch</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
    <span class="na">message</span><span class="p">:</span> <span class="nx">messages</span><span class="p">[</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">],</span>
    <span class="na">country</span><span class="p">:</span> <span class="nx">countries</span><span class="p">[</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">],</span>
    <span class="na">severity</span><span class="p">:</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">startDate</span><span class="p">.</span><span class="nf">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">731</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="na">metadata</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">value</span><span class="p">:</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="nx">labels</span><span class="p">[</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">batch</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">batchSize</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">benchmark_logs</span><span class="p">.</span><span class="nf">insertMany</span><span class="p">(</span><span class="nx">batch</span><span class="p">);</span>
    <span class="nx">batch</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>

<span class="p">}</span>

</code></pre>

</div>



<p>I checked the document schema and counts:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nf">print</span><span class="p">(</span><span class="s2">`Done!
 \nSample: </span><span class="p">${</span><span class="nx">EJSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span>  <span class="nx">db</span><span class="p">.</span><span class="nx">benchmark_logs</span><span class="p">.</span><span class="nf">find</span><span class="p">().</span><span class="nf">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">toArray</span><span class="p">(),</span>  <span class="kc">null</span><span class="p">,</span>  <span class="mi">2</span>  <span class="p">)}</span><span class="s2">
 \nDocument count: </span><span class="p">${</span><span class="nx">db</span><span class="p">.</span><span class="nx">benchmark_logs</span><span class="p">.</span><span class="nf">countDocuments</span><span class="p">().</span><span class="nf">toLocaleString</span><span class="p">()}</span><span class="s2">
`</span><span class="p">);</span>

<span class="nl">Sample</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">6997580679ab8450f81ff93c</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020-01-01T00:00:00Z</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>

<span class="nx">Document</span> <span class="nx">count</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span><span class="mi">000</span><span class="p">,</span><span class="mi">000</span>

</code></pre>

</div>



<p>With 100 million documents, this is a large dataset. Because many fields can be queried, we can’t create every compound index combination. A single search index will make queries on this collection efficient.</p>

<h2>
  
  
  Search index creation
</h2>

<p>I created the search index similar to the one used on ParadeDB (<a href="https://github.com/paradedb/paradedb/blob/v0.21.8/benchmarks/datasets/logs/create_index/pg_search.sql" rel="noopener noreferrer">here</a>):<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="kd">const</span> <span class="nx">mapping</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mappings</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// Equivalent to: USING bm25 Atlas Search uses Lucene BM25 by default</span>
    <span class="na">dynamic</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Equivalent to: bm25(id, message, ...) Standard full-text field scored by BM25</span>
      <span class="na">message</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="p">},</span>
      <span class="c1">// Equivalent to: text_fields = {  "country": {  fast: true, tokenizer: { type: "raw", lowercase: true } } } // fast = true → implicit in Atlas Search; docValues optional in cloud</span>
      <span class="na">country</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span> <span class="na">analyzer</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keywordLowercase</span><span class="dl">"</span> <span class="p">},</span>
      <span class="c1">// Equivalent to:numeric field indexed for filtering</span>
      <span class="na">severity</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span><span class="p">,</span> <span class="na">representation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">int64</span><span class="dl">"</span> <span class="p">},</span>
      <span class="c1">// Equivalent to:timestamp field included in the BM25 index</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span> <span class="p">},</span>
      <span class="c1">// Equivalent to: json_fields = { "metadata": { fast: true, tokenizer: raw } }</span>
      <span class="na">metadata</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">document</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">fields</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">value</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">representation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">int64</span><span class="dl">"</span>
          <span class="p">},</span>
          <span class="c1">// Equivalent to: metadata tokenizer = raw + lowercase</span>
          <span class="na">label</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">analyzer</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keywordLowercase</span><span class="dl">"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">analyzers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="c1">// Equivalent to: tokenizer = raw, lowercase = true</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keywordLowercase</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">tokenizer</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span> <span class="p">},</span>
      <span class="na">tokenFilters</span><span class="p">:</span> <span class="p">[{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lowercase</span><span class="dl">"</span> <span class="p">}]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">benchmark_logs</span><span class="p">.</span><span class="nf">createSearchIndex</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">benchmark_logs_idx</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">mapping</span>
<span class="p">);</span>

</code></pre>

</div>



<p>The index is created asynchronously and updated via change stream operations.</p>

<h2>
  
  
  Query and result
</h2>

<p>The query combines text search, range filter, sort by score, and limit for Top-K:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">$search</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">index</span><span class="p">:</span> <span class="dl">"</span><span class="s2">benchmark_logs_idx</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">compound</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">must</span><span class="p">:</span> <span class="p">[{</span> <span class="na">text</span><span class="p">:</span> <span class="p">{</span> <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">research team</span><span class="dl">"</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span> <span class="p">}</span> <span class="p">}],</span>
        <span class="na">filter</span><span class="p">:</span> <span class="p">[{</span> <span class="na">range</span><span class="p">:</span> <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">,</span> <span class="na">lt</span><span class="p">:</span> <span class="mi">3</span> <span class="p">}</span> <span class="p">}]</span>
      <span class="p">},</span>
      <span class="na">sort</span><span class="p">:</span> <span class="p">{</span> <span class="na">score</span><span class="p">:</span> <span class="p">{</span> <span class="na">$meta</span><span class="p">:</span> <span class="dl">"</span><span class="s2">searchScore</span><span class="dl">"</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span> <span class="na">$limit</span><span class="p">:</span> <span class="mi">10</span> <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">message</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">country</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">severity</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">metadata</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">rank</span><span class="p">:</span> <span class="p">{</span> <span class="na">$meta</span><span class="p">:</span> <span class="dl">"</span><span class="s2">searchScore</span><span class="dl">"</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>

<span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>

<span class="nf">print</span><span class="p">(</span><span class="nx">EJSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">db</span><span class="p">.</span><span class="nx">benchmark_logs</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nf">toArray</span><span class="p">(),</span><span class="kc">null</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>

<span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>
<span class="nf">print</span><span class="p">(</span><span class="s2">`\nExecution time: </span><span class="p">${</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">}</span><span class="s2"> ms`</span><span class="p">);</span>

</code></pre>

</div>



<p>It is important that the sort is part of <code>$search</code> because an additional <code>$sort</code> stage would not be pushed down. This allows Atlas Search to run the query in Lucene’s Top‑K mode, enabling block‑max WAND (BMW) pruning via competitive score feedback during collection. </p>

<p>Here is the result and timing:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code>
<span class="p">[{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d105</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-01-11T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d10f</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-01-21T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d119</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-01-31T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d123</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-02-10T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">41</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d12d</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-02-20T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d137</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-03-01T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">61</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d141</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-03-11T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d14b</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-03-21T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">81</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d155</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-03-31T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">},{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">699757049ce6a7c42c65d15f</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">The research team discovered a new species of deep-sea creature while conducting experiments near hydrothermal vents in the dark ocean depths.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">United States</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-04-10T00:00:00Z</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="mi">101</span><span class="p">,</span><span class="dl">"</span><span class="s2">label</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">critical system alert</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.6839379072189331</span><span class="p">}]</span>

<span class="nx">Execution</span> <span class="nx">time</span><span class="p">:</span> <span class="mi">1850</span> <span class="nx">ms</span>

</code></pre>

</div>



<p>On my laptop, this search over 100 million documents returns results in under two seconds, with no tuning. It performs a broad text match, and the high‑frequency terms "research" and "team" generate tens of millions of candidate documents. The additional severity filter and scoring require comparing tens of millions of scores, which has been heavily parallelized to stay within the two‑second budget.</p>

<h2>
  
  
  Performance breakdown (explain)
</h2>

<p>Because the execution plan is long, I’ve packed it into a short string that you can easily copy and paste into your preferred AI chatbot:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">EJSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">benchmark_logs</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nf">explain</span><span class="p">(</span><span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>

<span class="p">{</span><span class="dl">"</span><span class="s2">explainVersion</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">stages</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">$_internalSearchMongotRemote</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">mongotQuery</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">benchmark_logs_idx</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">compound</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">must</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">query</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">research team</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">}}],</span><span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">range</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">lt</span><span class="dl">"</span><span class="p">:</span><span class="mi">3</span><span class="p">}}]},</span><span class="dl">"</span><span class="s2">sort</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$meta</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">searchScore</span><span class="dl">"</span><span class="p">}}},</span><span class="dl">"</span><span class="s2">explain</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">query</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">BooleanQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">must</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">compound.must</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">BooleanQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">must</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">mustNot</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">should</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">TermQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">research</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">1.273251</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">87</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">1292.607756</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000011</span><span class="p">}}}},{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">TermQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">team</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.292666</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">87</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">379.190071</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span><span class="mi">10000011</span><span class="p">}}}}],</span><span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">minimumShouldMatch</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">2.268162</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">87</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">3838.859709</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000011</span><span class="p">}}}}],</span><span class="dl">"</span><span class="s2">mustNot</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">should</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">compound.filter</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">ConstantScoreQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">query</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">BooleanQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">must</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">mustNot</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">should</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">IndexOrDocValuesQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">query</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">PointRangeQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">representation</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">double</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">lte</span><span class="dl">"</span><span class="p">:</span><span class="mf">2.9999999999999996</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}},{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">SortedNumericDocValuesRangeQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}}]},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.010995</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">29</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}},{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">IndexOrDocValuesQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">query</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">PointRangeQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">representation</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">int64</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">lte</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}},{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">SortedNumericDocValuesRangeQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}}]},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">38.433371</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">87</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">875.507977</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">nextDoc</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000028</span><span class="p">,</span><span class="dl">"</span><span class="s2">refineRoughMatch</span><span class="dl">"</span><span class="p">:</span><span class="mi">11</span><span class="p">}},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}},{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">PointRangeQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">representation</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">int64</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">lte</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.010042</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">29</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}},{</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">PointRangeQuery</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">representation</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">double</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">lte</span><span class="dl">"</span><span class="p">:</span><span class="mf">2.9999999999999996</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.003208</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">29</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}}],</span><span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:[],</span><span class="dl">"</span><span class="s2">minimumShouldMatch</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">38.985005</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">84</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">2908.644175</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">nextDoc</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000028</span><span class="p">}},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}}},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">39.017415</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">84</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">5158.791968</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">nextDoc</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000028</span><span class="p">}},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}}}],</span><span class="dl">"</span><span class="s2">minimumShouldMatch</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">42.418625</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">createWeight</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">createScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">56</span><span class="p">}},</span><span class="dl">"</span><span class="s2">match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">14486.312741</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">nextDoc</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000028</span><span class="p">}},</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">5997.668304</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000000</span><span class="p">}}}},</span><span class="dl">"</span><span class="s2">collectors</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">allCollectorStats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">4965.753857</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">collect</span><span class="dl">"</span><span class="p">:</span><span class="mi">40000000</span><span class="p">,</span><span class="dl">"</span><span class="s2">competitiveIterator</span><span class="dl">"</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span><span class="dl">"</span><span class="s2">setScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">28</span><span class="p">}},</span><span class="dl">"</span><span class="s2">sort</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">fieldInfos</span><span class="dl">"</span><span class="p">:{},</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">prunedResultIterator</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">comparator</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">2841.984556</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">competitiveIterator</span><span class="dl">"</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span><span class="dl">"</span><span class="s2">setScorer</span><span class="dl">"</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span><span class="dl">"</span><span class="s2">setBottom</span><span class="dl">"</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span><span class="dl">"</span><span class="s2">compareBottom</span><span class="dl">"</span><span class="p">:</span><span class="mi">39999989</span><span class="p">,</span><span class="dl">"</span><span class="s2">setHitsThresholdReached</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">}}}}},</span><span class="dl">"</span><span class="s2">resultMaterialization</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">stats</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">millisElapsed</span><span class="dl">"</span><span class="p">:</span><span class="mf">0.660042</span><span class="p">,</span><span class="dl">"</span><span class="s2">invocationCounts</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">retrieveAndSerialize</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">}}},</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">mongotVersion</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">1.62.0-46-g84ab2fcdae</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">mongotHostName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">mongot-local-dev</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">benchmark_logs_idx</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">cursorOptions</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">batchSize</span><span class="dl">"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="dl">"</span><span class="s2">requiresSearchSequenceToken</span><span class="dl">"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span><span class="dl">"</span><span class="s2">lucene</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">totalSegments</span><span class="dl">"</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span><span class="dl">"</span><span class="s2">totalDocs</span><span class="dl">"</span><span class="p">:</span><span class="mi">100000000</span><span class="p">}},</span><span class="dl">"</span><span class="s2">resourceUsage</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">majorFaults</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">minorFaults</span><span class="dl">"</span><span class="p">:</span><span class="mi">176</span><span class="p">,</span><span class="dl">"</span><span class="s2">userTimeMs</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">systemTimeMs</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">maxReportingThreads</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">numBatches</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span><span class="dl">"</span><span class="s2">mongotDocsRequested</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">requiresSearchMetaCursor</span><span class="dl">"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalMongotBatchSizeHistory</span><span class="dl">"</span><span class="p">:[</span><span class="mi">11</span><span class="p">]},</span><span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},{</span><span class="dl">"</span><span class="s2">$_internalSearchIdLookup</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">limit</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">subPipeline</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">$match</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">_id placeholder</span><span class="dl">"</span><span class="p">}}}],</span><span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">numDocsFilteredByIdLookup</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">},{</span><span class="dl">"</span><span class="s2">$limit</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">},{</span><span class="dl">"</span><span class="s2">$project</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$meta</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">searchScore</span><span class="dl">"</span><span class="p">}},</span><span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">}],</span><span class="dl">"</span><span class="s2">queryShapeHash</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">6D0DB1E1511DBF0A7AB3E604CA873DCC75454A33B79F2669445ECF20A5452721</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">serverInfo</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">mongo</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span><span class="mi">27017</span><span class="p">,</span><span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">8.2.5</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">gitVersion</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">a471a13094434666c48a1f75451f2efa49f8f5df</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">serverParameters</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">internalQueryFacetBufferSizeBytes</span><span class="dl">"</span><span class="p">:</span><span class="mi">104857600</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalQueryFacetMaxOutputDocSizeBytes</span><span class="dl">"</span><span class="p">:</span><span class="mi">104857600</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalLookupStageIntermediateDocumentMaxSizeBytes</span><span class="dl">"</span><span class="p">:</span><span class="mi">104857600</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalDocumentSourceGroupMaxMemoryBytes</span><span class="dl">"</span><span class="p">:</span><span class="mi">104857600</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalQueryMaxBlockingSortMemoryUsageBytes</span><span class="dl">"</span><span class="p">:</span><span class="mi">104857600</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalQueryProhibitBlockingMergeOnMongoS</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalQueryMaxAddToSetBytes</span><span class="dl">"</span><span class="p">:</span><span class="mi">104857600</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalDocumentSourceSetWindowFieldsMaxMemoryBytes</span><span class="dl">"</span><span class="p">:</span><span class="mi">104857600</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalQueryFrameworkControl</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">trySbeRestricted</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">internalQueryPlannerIgnoreIndexWithCollationForRegex</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="dl">"</span><span class="s2">command</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">aggregate</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">benchmark_logs</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">pipeline</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">$search</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">benchmark_logs_idx</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">compound</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">must</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">query</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">research team</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">}}],</span><span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:[{</span><span class="dl">"</span><span class="s2">range</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">lt</span><span class="dl">"</span><span class="p">:</span><span class="mi">3</span><span class="p">}}]},</span><span class="dl">"</span><span class="s2">sort</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$meta</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">searchScore</span><span class="dl">"</span><span class="p">}}}},{</span><span class="dl">"</span><span class="s2">$limit</span><span class="dl">"</span><span class="p">:</span><span class="mi">10</span><span class="p">},{</span><span class="dl">"</span><span class="s2">$project</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">severity</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">rank</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$meta</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">searchScore</span><span class="dl">"</span><span class="p">}}}],</span><span class="dl">"</span><span class="s2">cursor</span><span class="dl">"</span><span class="p">:{},</span><span class="dl">"</span><span class="s2">$db</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">},</span><span class="dl">"</span><span class="s2">ok</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">$clusterTime</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">clusterTime</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">:</span><span class="mi">1771531370</span><span class="p">,</span><span class="dl">"</span><span class="s2">i</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span><span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">hash</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">base64</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">AAAAAAAAAAAAAAAAAAAAAAAAAAA=</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">subType</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">00</span><span class="dl">"</span><span class="p">}},</span><span class="dl">"</span><span class="s2">keyId</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">}},</span><span class="dl">"</span><span class="s2">operationTime</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">$timestamp</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">:</span><span class="mi">1771531370</span><span class="p">,</span><span class="dl">"</span><span class="s2">i</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">}}}</span>
</code></pre>

</div>



<p>The search runs against a 100‑million‑document search index split into 28 Lucene segments and requests only the top 10 results:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"indexName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"benchmark_logs_idx"</span><span class="err">,</span><span class="w">
</span><span class="nl">"lucene"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"totalDocs"</span><span class="p">:</span><span class="w"> </span><span class="mi">100000000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalSegments"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="nl">"mongotDocsRequested"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></code></pre>

</div>



<p>High‑frequency terms (<code>"research"</code> and <code>"team"</code>) cause the query to iterate over ~40 million documents, about 40% of the index:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"invocationCounts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"nextDoc"</span><span class="p">:</span><span class="w"> </span><span class="mi">40000028</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>Evaluating the boolean query and the <code>severity &lt; 3</code> filter over those candidate accounts for ~14.5 seconds of aggregated Lucene work:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"millisElapsed"</span><span class="p">:</span><span class="w"> </span><span class="mf">14486.312741</span><span class="p">,</span><span class="w">
  </span><span class="nl">"invocationCounts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"nextDoc"</span><span class="p">:</span><span class="w"> </span><span class="mi">40000028</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>Approximately 40 million documents are scored, resulting in ~6 seconds of aggregated scoring work:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"score"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"millisElapsed"</span><span class="p">:</span><span class="w"> </span><span class="mf">5997.668304</span><span class="p">,</span><span class="w">
  </span><span class="nl">"invocationCounts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"score"</span><span class="p">:</span><span class="w"> </span><span class="mi">40000000</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>Selecting the top 10 results requires ~40 million score comparisons, taking ~2.8 seconds of comparator work:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"collectors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"sort"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"stats"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"comparator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"millisElapsed"</span><span class="p">:</span><span class="w"> </span><span class="mf">2841.984556</span><span class="p">,</span><span class="w">
        </span><span class="nl">"invocationCounts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"compareBottom"</span><span class="p">:</span><span class="w"> </span><span class="mi">39999989</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>Explain aggregates Boolean matching, scoring, and sorting to roughly 20 seconds of total Lucene CPU work across all segments:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"millisElapsed"</span><span class="p">:</span><span class="w"> </span><span class="mf">14486.312741</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="nl">"score"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"millisElapsed"</span><span class="p">:</span><span class="w"> </span><span class="mf">5997.668304</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>Because the work is parallelized across 28 Lucene segments, the ~20 seconds of aggregated work completes in ~2 seconds of real latency:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"lucene"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"totalSegments"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>After the search completes, MongoDB fetches only 10 documents by <code>_id</code>, examining 10 keys and documents in ~1 ms:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="nl">"$_internalSearchIdLookup"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"totalDocsExamined"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalKeysExamined"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>The execution plan shows that the query scans and scores ~40% of a 100‑million‑document index, performs ~20 seconds of parallelized Lucene work, and still returns the top 10 results in ~2 seconds of wall‑clock time.</p>

<p>This is very similar to the execution plan with ParadeDB (except for the time, but this runs on different servers with different parallelism).</p>

<h2>
  
  
  Conclusion
</h2>

<p>Modern document databases must meet two demanding requirements: high write throughput and fast ranked search over large datasets. ParadeDB and MongoDB solve this by building BM25 indexes on top of Tantivy and Apache Lucene, respectively—search engines designed for these workloads.</p>

<p>A BM25 index combines an inverted index (to find candidate documents) with columnar metadata (to compute relevance scores and apply filters). This lets the engine quickly assemble a large candidate set and then rank it without loading full documents.</p>

<p>To support real‑time updates, both Tantivy and Lucene use a Log‑Structured Merge (LSM) design. Inserts and updates go to an in‑memory buffer rather than random in‑place writes. When the buffer fills or a statement completes, it is flushed to disk as an immutable segment.</p>

<p>Background compaction merges these segments into larger ones, resolves duplicates, and drops deleted documents. This turns random writes into mostly sequential I/O, sustaining high ingestion rates while keeping reads predictable.</p>

<p>The hard part is Top‑K queries, where results must be ordered by relevance (e.g., BM25). Scoring every matching document is infeasible when queries hit tens of millions of documents.</p>

<p>ParadeDB, via Tantivy, uses Block WAND to avoid this. Documents are grouped into blocks, each with an upper bound on the score any document in that block can reach. As the Top‑K heap fills, the engine sets a minimum score threshold. If a block’s maximum cannot beat that threshold, the entire block is skipped.</p>

<p>Lucene implements the same idea with block‑max WAND and related dynamic pruning. This pruning is driven by a dynamically increasing minimum competitive score: once the Top‑K heap fills, Lucene skips entire blocks of documents whose maximum possible score cannot exceed the current threshold. Atlas Search doesn’t expose this by name, but it is applied whenever you sort by <code>searchScore</code> and limit results. Execution plans showing huge candidate sets, but relatively small Top‑K collectors reveal this pruning. For queries dominated by required clauses (MUST/FILTER), Lucene also applies block‑max pruning at the conjunction level, further reducing unnecessary scoring.</p>

<p>Conceptually, ParadeDB and MongoDB share the same core techniques—immutable segments, LSM‑style merges, and WAND‑style pruning—to make Top‑K queries efficient. They mainly differ in how visible these mechanics are.</p>

<p>ParadeDB surfaces them via PostgreSQL <code>EXPLAIN</code>, where you can see <code>TopNScanExecState</code>, worker counts, and segment details. MongoDB hides most internals behind Atlas Search: users write <code>$search</code>, <code>$sort</code>, and <code>$limit</code>, and Lucene handles pruning and parallelism.</p>

<p>Update visibility is another key difference. ParadeDB aligns index updates closely with PostgreSQL transactions. MongoDB Atlas Search decouples the search engine from the primary database process, optimizing more aggressively for ingestion and query throughput. This creates a trade‑off: MongoDB Search offers near‑real‑time indexing with very high performance and scalability, but with eventual consistency between writes and search visibility. The delay is usually small but is a deliberate choice in favor of throughput and parallelism.</p>

<p>Both ParadeDB and MongoDB show that BM25‑based search can scale to tens of millions of candidates while still returning Top‑K results in milliseconds or seconds. They rely on LSM‑style indexing and WAND‑style pruning, differing mainly in how these optimizations are exposed and how they balance transactional immediacy against performance. In both systems, the search engine does massive work efficiently—and mostly invisibly—to the user.</p>

